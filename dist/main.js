(()=>{"use strict";const e=class{constructor(e,t){this._name=e,this._length=t,this._hits=0}get name(){return this._name}get length(){return this._length}get hits(){return this._hits}hit(){this._hits++}isSunk(){return this.hits>=this.length}},t=class{constructor(e){this.name=e,this.board=this.#e(),this.cells=this.#t(),this.ships={},this.misses=[]}placeShip(e,t){if(!this.validPlacement(e,t))return!1;for(let a=0;a<t.length;a++){this.cells[e].classList.add(t.name,"taken"),this.cells[e].dataset.shipName=t.name;let[a,s]=this.#a(e);e=String.fromCharCode(a.charCodeAt()+1)+s}return this.ships[t.name]=t,!0}placeShipsRandomly(){const t=[new e("carrier",5),new e("battleship",4),new e("destroyer",3),new e("submarine",3),new e("patrol",2)];for(let e=0;e<t.length;e++){let a=Math.floor(Math.random()*this.cellCoordinates().length),s=this.cellCoordinates()[a];this.validPlacement(s,t[e])?this.placeShip(s,t[e]):e--}}receiveAttack(e){const t=this.cells[e];if(t.className.includes("taken")){let a=t.dataset.shipName;return this.ships[a].hit(),this.cells[e].classList.add("hit"),!0}return this.misses.push(e),this.cells[e].classList.add("miss"),!1}allSunk(){return Object.entries(this.ships).every((([e,t])=>t.isSunk()))}cellCoordinates(){return Object.keys(this.cells)}validPlacement(e,t){return this.#s(e,t)&&this.#r(e,t)&&this.#n(t)}#e(){const e=document.createElement("div");e.classList.add(this.name,"board");for(let t=1;t<11;t++)for(let a=0;a<10;a++){const s=this.#i(t,a);e.appendChild(this.#l(s))}return e}#s(e,t){const a=e[0];return"ABCDEFGHIJ".indexOf(a)+t.length<=10}#n(e){return!this.ships[e.name]}#r(e,t){for(let a=0;a<t.length;a++){if(this.cells[e].className.includes("taken"))return!1;let[t,a]=this.#a(e);e=String.fromCharCode(t.charCodeAt()+1)+a}return!0}#a(e){const[t,a,s]=e.match(/([A-J])(\d+)/);return[a,s]}#i(e,t){return"ABCDEFGHIJ"[t]+e}#l(e){const t=document.createElement("div");return t.classList.add("cell"),t.dataset.coordinate=e,t}#t(){return[...this.board.children].reduce(((e,t)=>(e[t.dataset.coordinate]=t,e)),{})}},a=class{constructor(e){this.type=e,this.availableMoves=this.#d()}convertPlayerMove(e){return e.target.dataset.coordinate}getMove(){const e=this.#o(),t=this.availableMoves[e];return this.#c(t),t}#c(e){const t=this.availableMoves.indexOf(e);this.availableMoves.splice(t,1)}#o(){return Math.floor(Math.random()*this.availableMoves.length)}#d(){return(new t).cellCoordinates()}},s=(()=>{const e=document.querySelector(".boards-container");return{displayBoard:t=>{e.appendChild(t.board)}}})(),r=(()=>{let t,a,s,r;const n=e=>{e.dataTransfer.effectAllowed="move",t={name:e.target.dataset.name,length:Number(e.target.dataset.length)}},i=s=>{s.preventDefault(),s.target.classList.remove("valid-place"),s.target.classList.remove("invalid-place");const r=new e(t.name,t.length),n=s.target.dataset.coordinate;a.placeShip(n,r)},l=s=>{s.preventDefault();const r=new e(t.name,t.length),n=s.target.dataset.coordinate;a.validPlacement(n,r)?s.target.classList.add("valid-place"):s.target.classList.add("invalid-place")},d=e=>{e.preventDefault()},o=e=>{e.preventDefault(),e.target.classList.remove("valid-place"),e.target.classList.remove("invalid-place")},c=e=>{e.preventDefault(),"move"===e.dataTransfer.dropEffect&&a.ships[t.name]&&e.target.classList.add("clear")};return{setup:e=>{a=e,s=document.getElementById("destroyer-draggable"),r=document.getElementById("carrier-draggable"),Object.values(a.cells).forEach((e=>{e.addEventListener("dragover",d),e.addEventListener("dragenter",l),e.addEventListener("dragleave",o),e.addEventListener("drop",i)})),s.addEventListener("dragstart",n),s.addEventListener("dragend",c),r.addEventListener("dragstart",n),r.addEventListener("dragend",c)}}})();(()=>{const e=new a("human"),n=new a("ai");let i="human";const l=new t("player-board"),d=new t("ai-board");function o(){if("ai"===i){const e=n.getMove(),t=l.receiveAttack(e);if(console.log(l.allSunk(),"player"),!t)return void(i="human");o()}}s.displayBoard(l),s.displayBoard(d),r.setup(l),Array.from(d.board.childNodes).forEach((t=>{t.addEventListener("click",(t=>{!function(t){if(t&&"human"===i){const a=e.convertPlayerMove(t);d.receiveAttack(a)||(i="ai",o()),console.log(d.allSunk(),"ai")}}(t)}))})),d.placeShipsRandomly()})()})();